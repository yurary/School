<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body{
            justify-items: center;
            align-items: center;
            
            
        }


    </style>
</head>
<body>
    <main>
        <canvas id="myCanvas"  width="500" height="500" style="border:1px solid #000000;;"></canvas><br>
       
    </main>
    
    

    <script>
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        var xB = 500;
        var xM = 50;
        var mines = 5;
        var xxM = xM/2;
        console.log("zxc", xxM);
        
        
        
        function draw(x,y){
            ctx.beginPath();
            ctx.strokeRect(x,y, xM,xM);
            ctx.fillRect(x+5,y+5, xM-10,xM-10);
            ctx.stroke();

        }
        function drawselect(x,y){
            ctx.beginPath();
            ctx.fillStyle = "black";
            ctx.fillRect(x,y, xM,xM);
            ctx.fillStyle = "white";
            ctx.fillRect(x+5,y+5, xM-10,xM-10);
            ctx.stroke();
        }
        function drawluse(x,y){
            ctx.beginPath();
            ctx.fillStyle = "red";
            ctx.fillRect(x,y, xM,xM);
            ctx.stroke();
        }
        function check(x,y){
            ctx.beginPath();
            ctx.fillStyle = "Blue";
            ctx.fillRect(x-50,y-50, xM+100,xM+100);
           
            ctx.fillStyle = "orange";
            ctx.fillRect(x,y, xM,xM);
            
            ctx.stroke();

        }
        function whereMines(cellX, cellY, mines, cellSize) {
         let count = 0;

            for (let mine of mines) {
                const dx = Math.abs(mine.x - cellX);
                const dy = Math.abs(mine.y - cellY);

                if (
                    dx <= cellSize &&
                    dy <= cellSize &&
                    !(dx === 0 && dy === 0)
                    ) {
                        count++;
                    }
            }

            return count;
        }

        let n = 0;
        for(var j = 0; j<=xB; j+=xM){
            n++
        }
        
        

        for(var j = 0; j<=xB; j+=xM){
            var kor = Math.round(Math.random()*n);
            
            for(var i = 0; i<= xB; i+=xM){
                
                
                draw(i,j)
                
                
            }
        }
        let kordinatsMins = [];
        while(kordinatsMins.length !== mines){
            let posX = Math.round(Math.random() * (xB-100));
            let posY = Math.round(Math.random() * (xB-100));
            if(posX%xM == 0 && posY%xM==0){
                kordinatsMins.push({
                    x: posX,
                    y: posY

                });

            }
        }
       
        

        
        console.log(kordinatsMins);
        

        

        c.addEventListener("click", (e) => {
            const mouseX = e.offsetX;
            const mouseY = e.offsetY;

            for (let y = 0; y <= xB; y += xM) {
                for (let x = 0; x <= xB; x += xM) {

                    if (
                        mouseX >= x && mouseX < x + xM &&
                        mouseY >= y && mouseY < y + xM
                    ) {

        
                        for (let mine of kordinatsMins) {
                            if (
                                mouseX >= mine.x && mouseX < mine.x + xM &&
                                mouseY >= mine.y && mouseY < mine.y + xM
                            ) {
                                drawluse(x, y);
                                return;
                            }
                        }

        
                        const minesAround = whereMines(x, y, kordinatsMins, xM);

                        drawselect(x, y);

                        if (minesAround > 0) {
                            ctx.fillStyle = "black";
                            ctx.font = "20px Arial";
                            ctx.fillText(minesAround, x + xM / 2 - 5, y + xM / 2 + 7);
                        } else {
                            ctx.fillStyle = "white";
                            ctx.fillRect(x, y, xM, xM);
                        }
                        return;
                    }
                }
            }
        });




    </script>
</body>
</html>